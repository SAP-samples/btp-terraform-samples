'use strict';

const path = require('path');
const compressible = require('compressible');
const envConfig = require('../configuration/env-config');

const contentTypeMap = {
  '.json': 'application/json',
  '.txt': 'text/plain',
  '.html': 'text/html',
  '.js': 'application/javascript',
  '.css': 'text/css'
};

module.exports.getContentType = function getContentType(filePath) {
  const contentType = contentTypeMap[path.extname(filePath).toLowerCase()];
  return contentType || 'text/html';
};

module.exports.isResponseContentCompressible = function isResponseContentCompressible(req, res) {
  let type = res.getHeader && res.getHeader('Content-Type');
  if (type === undefined) {
    return false;
  }
  type = type.toLowerCase();
  if (((type.startsWith('multipart/mixed') || type.startsWith('multipart/x-mixed-replace')) &&
      getCompressResponseMixedTypeContent(req)) || compressible(type)) {
    return true;
  } else {
    return false;
  }
};

function getCompressResponseMixedTypeContent(req) {
  return ((envConfig.compression && envConfig.compression.compressResponseMixedTypeContent) ||
      (req.routerConfig && req.routerConfig.appConfig && req.routerConfig.appConfig.compression &&
          req.routerConfig.appConfig.compression.compressResponseMixedTypeContent));
}