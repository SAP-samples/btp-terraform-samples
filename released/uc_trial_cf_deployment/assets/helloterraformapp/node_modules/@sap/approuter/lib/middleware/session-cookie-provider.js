'use strict';

const tough = require('tough-cookie');
const _ = require('lodash');

module.exports = function sessionCookieProvider(req, cb) {
  if (!req.session._cookieJar) {
    return cb();
  }
  let jar = _.cloneDeep(req.session._cookieJar); // see tough-cookie issue #59
  tough.CookieJar.deserialize(jar, function (err, cookieJar) {
    if (err) {
      return cb(err);
    }
    cookieJar.getCookieString(req.internalUrl.href, cb);
  });
};
