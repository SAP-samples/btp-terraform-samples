'use strict';

const assert = require('assert');

module.exports = Extensions;

function Extensions(extensions) {
  assert(!extensions || Array.isArray(extensions),
    'extensions should be an array');

  if (!(this instanceof Extensions)) {
    return new Extensions(extensions);
  }

  this.extensions = extensions;
}

Extensions.prototype.insertMiddleware = function(slot, connectApp) {
  if (!this.extensions) { return; }
  for (let i = 0; i < this.extensions.length; ++i) {
    let insert = this.extensions[i].insertMiddleware;
    if (insert && insert[slot]) {
      let middleware = insert[slot];
      for (let j = 0; j < middleware.length; ++j) {
        let m = middleware[j];
        if (typeof m === 'function') {
          connectApp.use(m);
        } else if (m.path) {
          connectApp.use(m.path, m.handler);
        } else {
          connectApp.use(m.handler);
        }
      }
    }
  }
};
