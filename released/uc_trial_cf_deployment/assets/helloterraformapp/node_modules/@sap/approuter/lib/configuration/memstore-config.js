'use strict';

const MemoryStore = require('../backend-request/memstore');
const logoutProvider = require('../middleware/logout-provider');

exports.getExternalSessionStore = function (extSessionMgt) {
  if (extSessionMgt) {
    const filePath = extSessionMgt.externalStoreFilePath || `../utils/${extSessionMgt.storageType}-store`;
    return require(filePath).getStore(extSessionMgt.instanceName);
  }
};

exports.getMemoryStore = function (app) {
  const memoryStore = new MemoryStore({
    timeout: app.get('mainRouterConfig').sessionTimeout,
    externalSessionStore: app.get('externalSessionStore')
  });

  memoryStore.on('timeout', function (session) {
    logoutProvider.sessionTimeoutLogout(session, app);
  });

  memoryStore.on('update', function (sessionId, timeout) {
    app.approuter.emit('update', sessionId, timeout);
  });

  return memoryStore;
};
